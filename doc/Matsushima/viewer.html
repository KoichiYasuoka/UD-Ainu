<!DOCTYPE html><head><meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>『狄島夜話記』Universal Dependenciesコーパス</title>
<script src="../../editor/conllusvgview.js"></script>
<script src="../../editor/conllusvgedit.js"></script>
<script src="../../editor/conllusvgload.js"></script>
<script>
matsushima=new Object();
matsushima.apiURL="https://api.github.com/repos/KoichiYasuoka/UD-Ainu/git/trees/master:doc%2FMatsushima";
matsushima.rawURL="https://koichiyasuoka.github.io/UD-Ainu/doc/Matsushima/";
matsushima.gitURL="https://github.com/KoichiYasuoka/UD-Ainu/blob/master/doc/Matsushima/";
matsushima.init=function(){
  var t=document.getElementById("top").cloneNode(true);
  t.style.position="static";
  t.style.visibility="hidden";
  document.body.appendChild(t);
  matsushima.svg=new Array();
  matsushima.pre=new Array();
  matsushima.timer=setTimeout("clearTimeout(matsushima.timer);matsushima.checkview()",200);
  matsushima.volchange();
}
matsushima.checkview=function(){
  var t,r,b,i;
  matsushima.timer=setTimeout("clearTimeout(matsushima.timer);matsushima.checkview()",200);
  if(matsushima.curr==null)
    return;
  if(matsushima.svg[matsushima.curr]==null||matsushima.pre[matsushima.curr]==null){
    matsushima.buildup(matsushima.curr);
    return;
  }
  if(matsushima.svg[matsushima.curr].style.position=="absolute"){
    if(matsushima.pre[matsushima.curr].textContent>""){
      matsushima.svg[matsushima.curr].style.position="static";
      matsushima.svg[matsushima.curr].style.visibility="visible";
    }
  }
  matsushima.lemmatranslit(matsushima.curr);
  conllusvg.rewrite("pre"+matsushima.curr);
  r=matsushima.svg[matsushima.curr].getBoundingClientRect();
  t=r.top;
  b=r.bottom;
  r=document.getElementById("top").getBoundingClientRect().bottom;
  if(t-r>20){
    while(t-r>0){
      i=matsushima.svg[matsushima.curr-1];
      if(i==null)
        break;
      if(i.style.position=="absolute")
        break;
      matsushima.curr--;
      if(matsushima.curr==0)
        break;
      t=i.getBoundingClientRect().top;
    }
  }
  else if(b<r){
    while(b<r){
      i=matsushima.svg[matsushima.curr+1];
      if(i==null)
        break;
      if(i.style.position=="absolute")
        break;
      matsushima.curr++;
      if(matsushima.curr==matsushima.currmax)
        break;
      b=i.getBoundingClientRect().bottom;
    }
  }
  matsushima.lastTop=matsushima.svg[matsushima.curr].getBoundingClientRect().top;
  for(i=matsushima.curr+1;i<=matsushima.currmax;i++){
    if(matsushima.svg[i]==null||matsushima.pre[i]==null){
      matsushima.buildup(i);
      break;
    }
    if(matsushima.svg[i].style.position=="absolute"){
      if(matsushima.pre[i].textContent>""){
        matsushima.svg[i].style.position="static";
        matsushima.svg[i].style.visibility="visible";
      }
    }
    matsushima.lemmatranslit(i);
    conllusvg.rewrite("pre"+i);
    r=matsushima.svg[i].getBoundingClientRect();
    if(r.top-window.innerHeight-1000>0)
      break;
  }
}
matsushima.buildup=function(x){
  var t,i;
  if(matsushima.svg[x]==null){
    t=document.createElementNS("http://www.w3.org/2000/svg","svg");
    for(i=parseInt(x,10)+1;i<=matsushima.currmax;i++){
      if(matsushima.svg[i]!=null)
        break;
    }
    t.style.position="absolute";
    t.style.visibility="hidden";
    if(i>matsushima.currmax)
      document.body.appendChild(t);
    else
      document.body.insertBefore(t,matsushima.svg[i]);
    matsushima.svg[x]=t;
    t.addEventListener("mousedown",matsushima.onmousedown);
    t.addEventListener("touchstart",matsushima.onmousedown);
  }
  if(matsushima.pre[x]==null){
    t=document.createElement("pre");
    t.style.display="none";
    t.setAttribute("id","pre"+x);
    document.body.appendChild(t);
    matsushima.pre[x]=t;
    if(conllusvg.main["pre"+x]==null)
      conllusvg.view(matsushima.svg[x],"pre"+x);
    conllusvg.loadRemote("pre"+x,matsushima.raw+matsushima.txt[x]);
  }
}
matsushima.lemmatranslit=function(x){
  var s,t,i;
  if(matsushima.pre[x]==null)
    return;
  if(matsushima.pre[x].textContent.indexOf("Translit=")>0)
    return;
  s=matsushima.pre[x].textContent.split("\n");
  for(i=0;i<s.length;i++){
    t=s[i].split("\t");
    if(t.length==10){
      if(t[2]!="_"&&t[1]!=t[2]){
        if(t[9]=="_")
          t[9]="Translit="+t[2];
        else if(t[9].indexOf("Translit=")<0)
          t[9]=t[9]+"|Translit="+t[2];
        s[i]=t.join("\t");
      }
    }
  }
  conllusvg.loadText("pre"+x,s.join("\n"));
}
matsushima.volchange=function(){
  var s;
  matsushima.clearSVG();
  for(s in matsushima.pre){
    if(matsushima.pre[s]!=null)
      document.body.removeChild(matsushima.pre[s]);
    matsushima.pre[s]=null;
  }
  if(matsushima.dirTree==null)
    matsushima.gettree();
  else
    matsushima.writeSVG();
}
matsushima.gettree=function(){
  if(matsushima.request==null){
    matsushima.request=new XMLHttpRequest();
    matsushima.request.onload=matsushima.ongettree;
  }
  matsushima.request.open("GET",matsushima.apiURL);
  matsushima.request.send();
}
matsushima.ongettree=function(e){
  if(matsushima.request.status==200){
    matsushima.dirTree=matsushima.request.responseText;
    matsushima.writeSVG();
  }
}
matsushima.txtsort=function(x,y){
  if(x<y)
    return -1;
  if(x>y)
    return 1;
  return 0;
}
matsushima.writeSVG=function(){
  var r;
  matsushima.clearSVG();
  r=new RegExp("[0-9]+-[0-9]+[a-z]?.txt","g");
  matsushima.txt=matsushima.dirTree.match(r);
  matsushima.txt.sort(matsushima.txtsort);
  matsushima.currmax=matsushima.txt.length-1;
  matsushima.curr=0;
  matsushima.lastTop=null;
  matsushima.raw=matsushima.rawURL;
}
matsushima.clearSVG=function(){
  var x;
  matsushima.curr=matsushima.lastTop=null;
  if(matsushima.svg!=null){
    for(x in matsushima.svg){
      if(matsushima.svg[x]!=null){
        matsushima.svg[x].style.position="absolute";
        matsushima.svg[x].style.visibility="hidden";
      }
    }
  }
  if(document.scrollingElement==null)
    document.documentElement.scrollTop=0;
  else
    document.scrollingElement.scrollTop=0;
}
matsushima.onmousedown=function(e){
  var x,y;
  if(matsushima.lastX==null){
    matsushima.lastX=e.clientX;
    matsushima.lastY=e.clientY;
    return;
  }
  x=e.clientX-matsushima.lastX;
  y=e.clientY-matsushima.lastY;
  if(x*x+y*y>9){
    matsushima.lastX=e.clientX;
    matsushima.lastY=e.clientY;
    return;
  }
  matsushima.lastX=null;
  x=e.currentTarget;
  for(y in matsushima.svg){
    if(matsushima.svg[y]==x){
      window.open("https://corpus.kanji.zinbun.kyoto-u.ac.jp/db-machine/~yasuoka/kyodokenkyu/ud-kanbun/conllusvg/editor-kanbun.html#url="+matsushima.raw+matsushima.txt[y]);
      break;
    }
  }
}
matsushima.reload=function(){
  var i,r;
  for(i=matsushima.curr;i<=matsushima.currmax;i++){
    if(matsushima.svg[i]==null||matsushima.pre[i]==null)
      return;
    r=matsushima.svg[i].getBoundingClientRect();
    if(r.top>window.innerHeight||r.bottom<0)
      return;
    conllusvg.loadRemote("pre"+i,matsushima.raw+matsushima.txt[i]);
  }
}
matsushima.github=function(){
  window.open(matsushima.gitURL+matsushima.txt[matsushima.curr]);
}
</script>
<body onload="matsushima.init()">
<div id="top" style="position:fixed; top:0px; left:0px; padding:10px; width:100%; background:white">
<font size="+3"><b>狄島夜話記</b></font>
<input type="button" value="GitHub" onclick="matsushima.github()" />
<input type="button" value="Reload" onclick="matsushima.reload()" />
</div>
</body>
